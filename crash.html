<!-- cookie-clicker.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <script src="balance.js"></script>
    <title>Crash</title>
    <link rel="shortcut icon" href="img/icon.png" type="image/x-icon">
</head>
<body>
    <nav>
        <div class="nav-logo">
            <img src="/img/logo.png" alt="logo">
        </div>
        <div class="nav-searchbar" id="searchbar"></div>
    <div class="nav-menu" id="menu">
        <div class="nav-navigation">
            <a href="index.html">Home</a>
            <a href="#">Games</a>
            <span class="promo" id="promo">Promo</span>
            <a href="#">Help</a>
            <a href="roulette.html">Roulette</a>
            <a href="diamond-sweeper.html">Diamond Sweeper</a>
            <a href="cookie-clicker.html">Cookie Clicker</a>
            <a href="crash.html" class="link-active">Crash</a>
            </div>
        <div class="nav-profile">
            <div class="username" id="display-username">Username</div>
            <div class="profile-picture">
                <img id="profile-picture" src="">
            </div>
            <div class="nav-balance">
                <img class="balance-icon" src="img/coin.png" alt="balance-icon">
                <div id="balance-display"></div>
                <button><img src="img/add.png" alt="add"></button>
            </div>
            <div class="nav-settings">
                <img src="img/settings.png" alt="Settings" id="settings">
            </div>
        </div>
    </div>
    
    <div class="nav-hamburger">
        <img src="img/hamburger.png" alt="Menu" id="hamburger">
    </div>
</nav>

<div class="game-container">
    <h1>Crash Game</h1>
    <div id="crash-history">Crash History: </div>
    <div class="crash-controls">
        <input type="number" id="bet-amount" placeholder="Bet Amount" step="0.01">
        <input type="number" id="auto-cashout" placeholder="Auto Cashout (e.g., 2.0)">
        <button id="start-button">Start</button><br>
    </div>
    <button id="cashout-button" disabled>Cash Out</button>
    <canvas id="crash-chart" width="600" height="400"></canvas>
    <div id="result-message"></div>
</div>

<div id="settings-modal" class="modal">
    <div class="modal-content">
        <span class="close" id="settings-close">&times;</span>
        <h2>Settings</h2>
        <label for="username">Username:</label>
        <input type="text" id="username" placeholder="Enter your username"><br><br>
        <label for="profile-pic">Profile Picture URL:</label>
        <input type="text" id="profile-pic" placeholder="Enter URL of profile picture"><br><br>
        <button id="save-settings">Save</button>
    </div>
</div>

<div id="promo-modal" class="modal">
    <div class="modal-content">
        <span class="close" id="promo-close">&times;</span>
        <h2>Promo Code</h2>
        <label for="promo-code">Enter Promo Code:</label>
        <input type="text" id="promo-code" placeholder="Enter your code">
        <button id="apply-promo">Apply</button>
    </div>
</div>
    <script>  
    document.addEventListener('DOMContentLoaded', () => {
    const canvas = document.getElementById('crash-chart');
    const ctx = canvas.getContext('2d');
    const betAmountInput = document.getElementById('bet-amount');
    const autoCashoutInput = document.getElementById('auto-cashout');
    const startButton = document.getElementById('start-button');
    const cashoutButton = document.getElementById('cashout-button');
    const resultMessage = document.getElementById('result-message');
    const crashHistoryDisplay = document.getElementById('crash-history');

    let isPlaying = false;
    let multiplier = 1.0;
    let cashoutMultiplier = null;
    let gameInterval;

    // Wyświetlanie i aktualizacja balansu
    function getBalance() {
        return parseFloat(localStorage.getItem('balance')) || 0;
    }

    function setBalance(newBalance) {
        localStorage.setItem('balance', newBalance.toFixed(2));
        updateBalanceDisplay();
    }

    function updateBalanceDisplay() {
        const balanceDisplay = document.getElementById('balance-display');
        if (balanceDisplay) {
            balanceDisplay.textContent = `${getBalance().toFixed(2)}`;
        }
    }

    function updateCrashHistory(newCrash) {
        const crashHistory = JSON.parse(localStorage.getItem('crashHistory')) || [];
        crashHistory.unshift(newCrash);

        if (crashHistory.length > 5) {
            crashHistory.pop();
        }

        localStorage.setItem('crashHistory', JSON.stringify(crashHistory));
        displayCrashHistory();
    }

    function displayCrashHistory() {
        const crashHistory = JSON.parse(localStorage.getItem('crashHistory')) || [];
        crashHistoryDisplay.innerHTML = '' + crashHistory.map(crash => `<span style="color: ${crash >= 2 ? 'green' : '#fafafa'};">${crash}x</span>`).join(' - ');
    }

    startButton.addEventListener('click', startGame);
    cashoutButton.addEventListener('click', cashOut);

    function startGame() {
        if (isPlaying) return;

        const betAmount = parseFloat(betAmountInput.value);
        const autoCashout = parseFloat(autoCashoutInput.value);
        const currentBalance = getBalance();

        if (isNaN(betAmount) || betAmount <= 0) {
            alert("Please enter a valid bet amount.");
            return;
        }

        if (betAmount > currentBalance) {
            alert("Insufficient balance!");
            return;
        }

        setBalance(currentBalance - betAmount);

        isPlaying = true;
        cashoutMultiplier = null;
        resultMessage.innerHTML = "";
        multiplier = 1.0;
        startButton.disabled = true;
        cashoutButton.disabled = false;

        if (!isNaN(autoCashout) && autoCashout > 0) {
            cashoutMultiplier = autoCashout;
        }

        gameInterval = setInterval(updateGame, 100); // Aktualizuj co 100 ms
    }

    function updateGame() {
        const crashPoint = Math.random() * 2 + 1.01; // losowy crash point od 1.5 do 3.5
        multiplier += 0.01; // zwiększaj mnożnik o 0.01 na każdej iteracji

        // Rysowanie wykresu
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.beginPath();
        ctx.moveTo(0, canvas.height);
        ctx.lineTo(canvas.width * (multiplier / 10), canvas.height - (canvas.height * multiplier / 10));
        ctx.strokeStyle = "lime";
        ctx.stroke();

        // Wyświetlanie bieżącego mnożnika na środku
        ctx.font = "30px Arial";
        ctx.fillStyle = "white";
        ctx.textAlign = "center";
        ctx.fillText(multiplier.toFixed(2) + "x", canvas.width / 2, canvas.height / 2);

        // Sprawdzenie, czy gra powinna się zakończyć
        if (multiplier >= crashPoint || (cashoutMultiplier && multiplier >= cashoutMultiplier)) {
            clearInterval(gameInterval);
            if (cashoutMultiplier && multiplier >= cashoutMultiplier) {
                endGame(true);
            } else {
                endGame(false);
            }
            updateCrashHistory(multiplier.toFixed(2));
        }
    }

    function cashOut() {
        if (!isPlaying) return;
        clearInterval(gameInterval);
        endGame(true);
        updateCrashHistory(multiplier.toFixed(2));
    }

    function endGame(didWin) {
        isPlaying = false;
        startButton.disabled = false;
        cashoutButton.disabled = true;

        const betAmount = parseFloat(betAmountInput.value);

        if (didWin) {
            const winnings = betAmount * multiplier;
            const newBalance = getBalance() + winnings;
            setBalance(newBalance);
            resultMessage.innerHTML = `You cashed out at ${multiplier.toFixed(2)}x and won <img src="img/coin.png" id="crash-coin" alt="coin" style="width: 16px;"> ${winnings.toFixed(2)}!`;
        } else {
            resultMessage.textContent = `The game crashed at ${multiplier.toFixed(2)}x. You lost!`;
        }
    }

    // Inicjalizacja wyświetlania balansu na stronie i historii crashy
    updateBalanceDisplay();
    displayCrashHistory();
});


        // Inicjalizacja stanu gry po załadowaniu strony
        window.onload = function() {
            updateBalanceDisplay();

            // Ładowanie ustawień użytkownika
            const savedUsername = localStorage.getItem('username');
            const savedProfilePic = localStorage.getItem('profilePic');

            if (savedUsername) {
                document.getElementById('display-username').textContent = savedUsername;
            }

            if (savedProfilePic) {
                document.getElementById('profile-picture').src = savedProfilePic;
            }
        };

        //OBSŁUGA MENU

    const menuBtn = document.getElementById("hamburger");
    const menu = document.getElementById("menu");

    menuBtn.addEventListener('click', function(){
        menu.classList.toggle("menu-open");
    });

     //MODAL
const settingsModal = document.getElementById('settings-modal');
const settingsBtn = document.getElementById('settings');
const settingsClose = document.getElementById('settings-close');
const saveSettings = document.getElementById('save-settings');

settingsBtn.onclick = function () {
    settingsModal.style.display = 'block';
};

settingsClose.onclick = function () {
    settingsModal.style.display = 'none';
};

saveSettings.onclick = function () {
    const username = document.getElementById('username').value;
    const profilePic = document.getElementById('profile-pic').value;

    if (username) {
        localStorage.setItem('username', username);
        document.getElementById('display-username').textContent = username;
    }

    if (profilePic) {
        localStorage.setItem('profilePic', profilePic);
        document.getElementById('profile-picture').src = profilePic;
    }

    settingsModal.style.display = 'none';
};

// Ładowanie ustawień z localStorage
window.onload = function () {
    const savedUsername = localStorage.getItem('username');
    const savedProfilePic = localStorage.getItem('profilePic');

    if (savedUsername) {
        document.getElementById('display-username').textContent = savedUsername;
    }

    if (savedProfilePic) {
        document.getElementById('profile-picture').src = savedProfilePic;
    }
};


// Promo Modal
const promoModal = document.getElementById('promo-modal');
const promoBtn = document.getElementById('promo');
const promoClose = document.getElementById('promo-close');
const applyPromo = document.getElementById('apply-promo');
let isValid = true;

promoBtn.onclick = function () {
    promoModal.style.display = 'block';
};

promoClose.onclick = function () {
    promoModal.style.display = 'none';
};

applyPromo.onclick = function () {
    const promoCode = document.getElementById('promo-code').value;

    if (promoCode === 'SKIBIDI20') {
        if (isValid == true) {
        const currentBalance = parseFloat(localStorage.getItem('balance')) || 0;
        const newBalance = currentBalance + 20;
        localStorage.setItem('balance', newBalance.toFixed(2));
        alert('Promo code applied! Your balance has been increased by 20.00.');
        updateBalanceDisplay();
        promoModal.style.display = 'none';
        isValid = false;
        }
    } else {
        alert('Invalid promo code!');
    }
};
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <script src="balance.js"></script>
    <title>Plinko</title>
    <link rel="shortcut icon" href="img/icon.png" type="image/x-icon">
    <style>
        /* Prosty styl dla planszy i kulek */
        .board {
            position: relative;
            width: 250px;
            height: 400px;
            background-color: #f0f0f0;
            margin: 20px auto;
            border: 2px solid #000;
            overflow: hidden;
        }

        .peg {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #333;
            border-radius: 50%;
        }

        .ball {
            position: absolute;
            width: 15px;
            height: 15px;
            background-color: red;
            border-radius: 50%;
        }

        .pocket {
            position: absolute;
            bottom: 0;
            width: 50px;
            height: 30px;
            border: 1px solid #000;
            text-align: center;
            background-color: #ccc;
        }

        #result-message {
            margin: 20px;
            text-align: center;
            font-size: 18px;
        }

    </style>
</head>
<body>
    <nav>
        <div class="nav-logo">
            <img src="/img/logo.png" alt="logo">
        </div>
        <div class="nav-searchbar" id="searchbar"></div>
    <div class="nav-menu" id="menu">
        <div class="nav-navigation">
            <a href="index.html">Home</a>
            <a href="#">Games</a>
            <span class="promo" id="promo">Promo</span>
            <a href="#">Help</a>
            <a href="roulette.html">Roulette</a>
            <a href="diamond-sweeper.html">Diamond Sweeper</a>
            <a href="cookie-clicker.html">Cookie Clicker</a>
            <a href="crash.html">Crash</a>
            <a href="plinko.html" class="link-active">Plinko</a>
            </div>
        <div class="nav-profile">
            <div class="username" id="display-username">Username</div>
            <div class="profile-picture">
                <img id="profile-picture" src="">
            </div>
            <div class="nav-balance">
                <img class="balance-icon" src="img/coin.png" alt="balance-icon">
                <div id="balance-display"></div>
                <button><img src="img/add.png" alt="add"></button>
            </div>
            <div class="nav-settings">
                <img src="img/settings.png" alt="Settings" id="settings">
            </div>
        </div>
    </div>
    
    <div class="nav-hamburger">
        <img src="img/hamburger.png" alt="Menu" id="hamburger">
    </div>
</nav>

<div>
    <label for="ball-count">Number of Balls (1-5): </label>
    <input type="number" id="ball-count" min="1" max="5" value="1">
</div>
<div>
    <label for="bet-amount">Bet Amount: </label>
    <input type="number" id="bet-amount" value="0.00">
</div>
<button id="release-button">Release Ball</button>

<div class="board" id="plinko-board">
    <!-- Plansza z kołkami -->
</div>
<div id="result-message"></div>


    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <span class="close" id="settings-close">&times;</span>
            <h2>Settings</h2>
            <label for="username">Username:</label>
            <input type="text" id="username" placeholder="Enter your username"><br><br>
            <label for="profile-pic">Profile Picture URL:</label>
            <input type="text" id="profile-pic" placeholder="Enter URL of profile picture"><br><br>
            <button id="save-settings">Save</button>
        </div>
    </div>
    
    <div id="promo-modal" class="modal">
        <div class="modal-content">
            <span class="close" id="promo-close">&times;</span>
            <h2>Promo Code</h2>
            <label for="promo-code">Enter Promo Code:</label>
            <input type="text" id="promo-code" placeholder="Enter your code">
            <button id="apply-promo">Apply</button>
        </div>
    </div>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // Inicjalizacja balansu
        updateBalanceDisplay();
        createBoard();
        document.getElementById('release-button').addEventListener('click', releaseBall);
    });
    
    function updateBalanceDisplay() {
        const balance = parseFloat(localStorage.getItem('balance')) || 0;
        document.getElementById('balance-display').textContent = `${balance.toFixed(2)}`;
    }
    
    function getBalance() {
        return parseFloat(localStorage.getItem('balance')) || 0;
    }
    
    function setBalance(amount) {
        localStorage.setItem('balance', amount.toFixed(2));
        updateBalanceDisplay();
    }
    
    function createBoard() {
        const board = document.getElementById('plinko-board');
        const rows = 6;
        const pegsPerRow = 7;
        const pegOffsetX = 30;
        const pegOffsetY = 50;
    
        // Tworzenie kołków w formie trójkąta
        for (let i = 0; i < rows; i++) {
            for (let j = 0; j < pegsPerRow - i; j++) {
                const peg = document.createElement('div');
                peg.classList.add('peg');
                peg.style.left = `${j * pegOffsetX + (i * pegOffsetX / 2)}px`;
                peg.style.top = `${i * pegOffsetY}px`;
                board.appendChild(peg);
            }
        }
    
        // Tworzenie kieszeni na dole planszy
        const pocketValues = [1.5, 2, 3, 5, 3, 2, 1.5];
        pocketValues.forEach((value, index) => {
            const pocket = document.createElement('div');
            pocket.classList.add('pocket');
            pocket.style.left = `${index * pegOffsetX + (pegOffsetX / 2)}px`;
            pocket.textContent = `${value}x`;
            board.appendChild(pocket);
        });
    }
    
    function releaseBall() {
        const ballCount = parseInt(document.getElementById('ball-count').value);
        const betAmount = parseFloat(document.getElementById('bet-amount').value);
        const currentBalance = getBalance();
    
        if (isNaN(betAmount) || betAmount <= 0) {
            alert('Please enter a valid bet amount.');
            return;
        }
    
        const totalBet = betAmount * ballCount;
    
        if (currentBalance < totalBet) {
            alert('Insufficient balance!');
            return;
        }
    
        setBalance(currentBalance - totalBet);
    
        for (let i = 0; i < ballCount; i++) {
            setTimeout(() => {
                dropBall(betAmount);
            }, i * 500);
        }
    }
    
    function dropBall(betAmount) {
        const ball = document.createElement('div');
        ball.classList.add('ball');
        ball.style.left = '140px'; // Start w środku planszy
        document.getElementById('plinko-board').appendChild(ball);
    
        let positionY = 0;
        let velocityX = 2 * (Math.random() < 0.5 ? -1 : 1); // Losowy ruch w lewo/prawo
        let interval = setInterval(() => {
            positionY += 4; // Przesunięcie w pionie
            ball.style.top = `${positionY}px`;
    
            const boardWidth = document.getElementById('plinko-board').offsetWidth;
            const ballLeft = parseInt(ball.style.left);
    
            // Odbicia od boków planszy
            if (ballLeft <= 0 || ballLeft >= boardWidth - ball.offsetWidth) {
                velocityX *= -1;
            }
    
            ball.style.left = `${ballLeft + velocityX}px`;
    
            // Logika kolizji z kołkami
            const pegs = document.querySelectorAll('.peg');
            pegs.forEach(peg => {
                const pegRect = peg.getBoundingClientRect();
                const ballRect = ball.getBoundingClientRect();
                const distance = Math.hypot(pegRect.left - ballRect.left, pegRect.top - ballRect.top);
                if (distance < 10) {
                    velocityX *= -1;
                }
            });
    
            // Gdy piłka osiągnie dół planszy
            if (positionY >= 360) {
                clearInterval(interval);
                calculateWinnings(betAmount, ball);
            }
        }, 20);
    }
    
    function calculateWinnings(betAmount, ball) {
        const ballRect = ball.getBoundingClientRect();
        const pockets = document.querySelectorAll('.pocket');
        let winnings = 0;
    
        pockets.forEach(pocket => {
            const pocketRect = pocket.getBoundingClientRect();
            if (
                ballRect.left + ballRect.width / 2 > pocketRect.left &&
                ballRect.left + ballRect.width / 2 < pocketRect.right
            ) {
                const multiplier = parseFloat(pocket.textContent);
                winnings = betAmount * multiplier;
            }
        });
    
        const currentBalance = getBalance();
        setBalance(currentBalance + winnings);
        document.getElementById('result-message').textContent = `You won ${winnings.toFixed(2)}!`;
    
        // Usunięcie kulki po 2 sekundach
        setTimeout(() => {
            ball.remove();
        }, 2000);
    }
    




//OBSŁUGA MENU

const menuBtn = document.getElementById("hamburger");
    const menu = document.getElementById("menu");

    menuBtn.addEventListener('click', function(){
        menu.classList.toggle("menu-open");
    });

     //MODAL
const settingsModal = document.getElementById('settings-modal');
const settingsBtn = document.getElementById('settings');
const settingsClose = document.getElementById('settings-close');
const saveSettings = document.getElementById('save-settings');

settingsBtn.onclick = function () {
    settingsModal.style.display = 'block';
};

settingsClose.onclick = function () {
    settingsModal.style.display = 'none';
};

saveSettings.onclick = function () {
    const username = document.getElementById('username').value;
    const profilePic = document.getElementById('profile-pic').value;

    if (username) {
        localStorage.setItem('username', username);
        document.getElementById('display-username').textContent = username;
    }

    if (profilePic) {
        localStorage.setItem('profilePic', profilePic);
        document.getElementById('profile-picture').src = profilePic;
    }

    settingsModal.style.display = 'none';
};

// Ładowanie ustawień z localStorage
window.onload = function () {
    const savedUsername = localStorage.getItem('username');
    const savedProfilePic = localStorage.getItem('profilePic');

    if (savedUsername) {
        document.getElementById('display-username').textContent = savedUsername;
    }

    if (savedProfilePic) {
        document.getElementById('profile-picture').src = savedProfilePic;
    }
};


// Promo Modal
const promoModal = document.getElementById('promo-modal');
const promoBtn = document.getElementById('promo');
const promoClose = document.getElementById('promo-close');
const applyPromo = document.getElementById('apply-promo');
let isValid = true;

promoBtn.onclick = function () {
    promoModal.style.display = 'block';
};

promoClose.onclick = function () {
    promoModal.style.display = 'none';
};

applyPromo.onclick = function () {
    const promoCode = document.getElementById('promo-code').value;

    if (promoCode === 'SKIBIDI20') {
        if (isValid == true) {
        const currentBalance = parseFloat(localStorage.getItem('balance')) || 0;
        const newBalance = currentBalance + 20;
        localStorage.setItem('balance', newBalance.toFixed(2));
        alert('Promo code applied! Your balance has been increased by 20.00.');
        updateBalanceDisplay();
        promoModal.style.display = 'none';
        isValid = false;
        }
    } else {
        alert('Invalid promo code!');
    }
};
    </script>
</body>
</html>